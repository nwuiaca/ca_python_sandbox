COMMENT
//ANALYTIC Robot to upload kfs test results
  Import audit test results from various odbc connectors
//RESULT LOG
END

COMMENT
INDEX
ODBC64
    Sqlite_kfs->W:\Kfs\Kfs\Kfs.sqlite
    Sqlite_kfs_test_creditor->W:\Kfs\Kfs_test_creditor.sqlite
    Sqlite_kfs_test_gl_transaction->W:\Kfs\Kfs_test_gl_transaction.sqlite
ENVIRONMENT
KFS
    GL TRANSACTION TESTS
        PROFESSIONAL FEE PAID TO STUDENT
        DONOR EXCLUDE LIST
        DONOR INCLUDE LIST
        DONOR ALL TRANSACTIONS
    VENDOR MASTER FILE TESTS
        VENDOR BANK ACCOUNT VERIFY BY PHONE (Inactive 20210527)
        DV VENDOR POSSIBLE PO VENDOR
        BANK ACCOUNT VERIFICATION
        VENDOR WITH EMPLOYEE EMAIL
        VENDOR WITH INVALID COMPANY REGISTRATION NUMBER
    VENDOR PAYMENT TESTS
        EMPLOYEE APPROVE OWN PAYMENT
        EMPLOYEE INITIATE OWN PAYMENT
        FISCAL OFFICER INITIATE PAYMENT
        SPOUSE APPROVE PAYMENT
        DUPLICATE PAYMENT METHOD 1
        SPLIT PAYMENT QUOTE 100000
        SPLIT PAYMENT QUOTE 250000
        SPLIT PAYMENT SMALL 5000
ENVIRONMENT RESET
END

COMMENT ENVIRONMENT
COMMENT ****************************************************************************************************

DO _Password
ASSIGN v_odbc_kfs = "Sqlite_kfs"
ASSIGN v_odbc_kfs_test_creditor = "Sqlite_kfs_test_creditor"
ASSIGN v_odbc_kfs_test_gl_transaction = "Sqlite_kfs_test_gl_transaction"
SET SAFETY OFF

COMMENT GL TRANSACTION TESTS
COMMENT ****************************************************************************************************

COMMENT PROFESSIONAL FEE PAID TO STUDENT

ACCESSDATA64 ODBC "Dsn" NAME "%v_odbc_kfs_test_gl_transaction%" TO "GL_TEST_TRAN_PROF_FEE_TO_STUDENT.FIL" CHARMAX 100 MEMOMAX 100 
 SOURCE( )
 SQL_QUERY( SELECT * FROM X001ax_professional_fee_student ) END_QUERY 
OPEN GL_TEST_TRAN_PROF_FEE_TO_STUDENT
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL ACLGRC PASSWORD 1 TO "80905@eu"
CLOSE PRIMARY

COMMENT DONOR EXCLUDE LIST

ACCESSDATA64 ODBC "Dsn" NAME "%v_odbc_kfs%" TO "Donors_list_exclude.FIL" CHARMAX 50 MEMOMAX 100 
SOURCE()
SQL_QUERY( SELECT * FROM X000_Own_kfs_lookups WHERE LOOKUP = 'EXCLUDE GL DONOR RECORD' ) END_QUERY 
OPEN Donors_list_exclude
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL PASSWORD 1 ACLGRC TO "238732@eu" OVERWRITE

COMMENT DONOR INCLUDE LIST

ACCESSDATA64 ODBC "Dsn" NAME "%v_odbc_kfs%" TO "Donors_list_include.FIL" CHARMAX 50 MEMOMAX 100 
SOURCE()
SQL_QUERY( SELECT * FROM X000_Own_kfs_lookups WHERE LOOKUP = 'IDENTIFY GL DONOR RECORD' ) END_QUERY 
OPEN Donors_list_include
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL PASSWORD 1 ACLGRC TO "238731@eu" OVERWRITE

COMMENT DONOR ALL TRANSACTIONS

ACCESSDATA64 ODBC "Dsn" NAME "%v_odbc_kfs_test_gl_transaction%" TO "Donors_all.fil" CHARMAX 256 MEMOMAX 256
SOURCE( )
SQL_QUERY( SELECT * FROM X003ax_donor_all_transaction ) END_QUERY
OPEN Donors_all
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL PASSWORD 1 ACLGRC TO "291682@eu" OVERWRITE

COMMENT VENDOR MASTER FILE TESTS
COMMENT ****************************************************************************************************

COMMENT VENDOR BANK ACCOUNT VERIFY BY PHONE

COMMENT ACCESSDATA64 ODBC "Dsn" NAME "%v_odbc_kfs_test_creditor%" TO "VENDOR_TEST_BANKACC_VERIFY_MAIL.FIL" CHARMAX 100 MEMOMAX 100 
COMMENT  SOURCE( )
COMMENT  SQL_QUERY( SELECT * FROM X002ax_vendor_bank_change WHERE EMAIL1 = "" ) END_QUERY
COMMENT OPEN VENDOR_TEST_BANKACC_VERIFY_MAIL
COMMENT COUNT
COMMENT IF COUNT1 > 0 EXPORT FIELDS ALL ACLGRC PASSWORD 1 TO "79751@eu"
COMMENT CLOSE PRIMARY

COMMENT DV VENDOR POSSIBLE PO VENDOR

ACCESSDATA64 ODBC "Dsn" NAME "%v_odbc_kfs_test_creditor%" TO "VENDOR_TEST_DV_POSSIBLE_PO.FIL" CHARMAX 100 MEMOMAX 100 
 SOURCE( )
 SQL_QUERY( SELECT * FROM X001dx_dv_vendor_possible_po_vendor ) END_QUERY 
OPEN VENDOR_TEST_DV_POSSIBLE_PO
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL ACLGRC PASSWORD 1 TO "102356@eu"
CLOSE PRIMARY

COMMENT VENDOR MASTER FILE TEST - BANK ACCOUNT VERIFICATION

ASSIGN v_audit_finding = "VENDOR BANK ACCOUNT VERIFY"
ASSIGN v_file_name = "VENDOR_TEST_BANK_ACC_VERIFY"
ASSIGN v_source_file = "X002bx_vendor_bank_account_verification"
ACCESSDATA64 ODBC "Dsn" NAME "%v_odbc_kfs_test_creditor%" TO "%v_file_name%.fil" CHARMAX 100 MEMOMAX 100 
SOURCE( )
SQL_QUERY( SELECT * FROM %v_source_file%) END_QUERY
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL PASSWORD 1 ACLGRC TO "247368@eu"

COMMENT VENDOR MASTER FILE TEST - VENDOR WITH EMPLOYEE EMAIL

ASSIGN v_audit_finding = "VENDOR WITH EMPLOYEE EMAIL"
ASSIGN v_file_name = "Vendor_with_employee_email"
ASSIGN v_source_file = "X002cx_vendor_employee_email"
ACCESSDATA64 ODBC "Dsn" NAME "%v_odbc_kfs_test_creditor%" TO "%v_file_name%.fil" CHARMAX 100 MEMOMAX 100 
SOURCE( )
SQL_QUERY( SELECT * FROM %v_source_file%) END_QUERY
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL PASSWORD 1 ACLGRC TO "245183@eu"

COMMENT VENDOR MASTER FILE TEST - VENDOR WITH INVALID COMPANY REGISTRATION NUMBER

ASSIGN v_audit_finding = "VENDOR INVALID REGISTRATION NUMBER"
ASSIGN v_file_name = "VENDOR_TEST_INVALID_REGNO"
ASSIGN v_source_file = "X002dx_vendor_invalid_registration_number"
ACCESSDATA64 ODBC "Dsn" NAME "%v_odbc_kfs_test_creditor%" TO "%v_file_name%.fil" CHARMAX 100 MEMOMAX 100 
SOURCE( )
SQL_QUERY( SELECT * FROM %v_source_file%) END_QUERY
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL PASSWORD 1 ACLGRC TO "249510@eu"

COMMENT VENDOR PAYMENT TESTS
COMMENT ****************************************************************************************************

COMMENT DUPLICATE PAYMENT METHOD 1

ACCESSDATA64 ODBC "Dsn" NAME "%v_odbc_kfs_test_creditor%" TO "VENDOR_PAY_TEST_DUPLICATE_1.FIL" CHARMAX 100 MEMOMAX 100 
 SOURCE( )
 SQL_QUERY( SELECT * FROM X001ax_paym_duplicate ) END_QUERY 
OPEN VENDOR_PAY_TEST_DUPLICATE_1
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL ACLGRC PASSWORD 1 TO "79031@eu"
CLOSE PRIMARY

COMMENT FISCAL OFFICER INITIATE PAYMENT

ACCESSDATA64 ODBC "Dsn" NAME "%v_odbc_kfs_test_creditor%" TO "VENDOR_PAY_TEST_FISCAL_OFF_INITIATE.FIL" CHARMAX 100 MEMOMAX 100 
 SOURCE( )
 SQL_QUERY( SELECT * FROM X001cx_same_initiator_fiscaloff ) END_QUERY 
OPEN VENDOR_PAY_TEST_FISCAL_OFF_INITIATE
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL ACLGRC PASSWORD 1 TO "90066@eu"
CLOSE PRIMARY

COMMENT SPLIT PAYMENT SMALL 5000

ACCESSDATA64 ODBC "Dsn" NAME "%v_odbc_kfs_test_creditor%" TO "VENDOR_PAY_TEST_SPLIT_SMALL.FIL" CHARMAX 100 MEMOMAX 100 
 SOURCE( )
 SQL_QUERY( SELECT * FROM X001bx_vendor_small_split_payment ) END_QUERY 
OPEN VENDOR_PAY_TEST_SPLIT_SMALL
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL ACLGRC PASSWORD 1 TO "97153@eu"
CLOSE PRIMARY

COMMENT SPLIT PAYMENT QUOTE 100000

ACCESSDATA64 ODBC "Dsn" NAME "%v_odbc_kfs_test_creditor%" TO "VENDOR_PAY_TEST_SPLIT_QUOTE.FIL" CHARMAX 100 MEMOMAX 100 
 SOURCE( )
 SQL_QUERY( SELECT * FROM X001ex_vendor_quote_split_payment ) END_QUERY 
OPEN VENDOR_PAY_TEST_SPLIT_QUOTE
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL ACLGRC PASSWORD 1 TO "97385@eu"
CLOSE PRIMARY

COMMENT SPLIT PAYMENT QUOTE 250000

ACCESSDATA64 ODBC "Dsn" NAME "%v_odbc_kfs_test_creditor%" TO "VENDOR_PAY_TEST_SPLIT_250K_QUOTE.FIL" CHARMAX 100 MEMOMAX 100 
 SOURCE( )
 SQL_QUERY( SELECT * FROM X001fx_vendor_quote_250k_split_payment ) END_QUERY 
OPEN VENDOR_PAY_TEST_SPLIT_250K_QUOTE
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL ACLGRC PASSWORD 1 TO "195122@eu"
CLOSE PRIMARY

COMMENT EMPLOYEE APPROVE OWN PAYMENT

ACCESSDATA64 ODBC "Dsn" NAME "%v_odbc_kfs_test_creditor%" TO "VENDOR_PAY_TEST_EMPL_APPROVE_OWN.FIL" CHARMAX 100 MEMOMAX 100 
 SOURCE( )
 SQL_QUERY( SELECT * FROM X003ax_empl_approve_own_payment ) END_QUERY 
OPEN VENDOR_PAY_TEST_EMPL_APPROVE_OWN
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL ACLGRC PASSWORD 1 TO "80492@eu"
CLOSE PRIMARY

COMMENT EMPLOYEE INITIATE OWN PAYMENT

ACCESSDATA64 ODBC "Dsn" NAME "%v_odbc_kfs_test_creditor%" TO "VENDOR_PAY_TEST_EMPL_INITIATE_OWN.FIL" CHARMAX 100 MEMOMAX 100 
 SOURCE( )
 SQL_QUERY( SELECT * FROM X003bx_empl_initiate_own_payment ) END_QUERY 
OPEN VENDOR_PAY_TEST_EMPL_INITIATE_OWN
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL ACLGRC PASSWORD 1 TO "80493@eu"
CLOSE PRIMARY

COMMENT SPOUSE APPROVE PAYMENT

ACCESSDATA64 ODBC "Dsn" NAME "%v_odbc_kfs_test_creditor%" TO "VENDOR_PAY_TEST_SPOUSE_APPROVE_PAYMENT.FIL" CHARMAX 100 MEMOMAX 100 
 SOURCE( )
 SQL_QUERY( SELECT * FROM X003cx_spouse_approve_payment ) END_QUERY 
OPEN VENDOR_PAY_TEST_SPOUSE_APPROVE_PAYMENT
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL ACLGRC PASSWORD 1 TO "206590@eu"
CLOSE PRIMARY

COMMENT ENVIRONMENT RESET
COMMENT ****************************************************************************************************

CLOSE PRIMARY
SET SAFETY ON
