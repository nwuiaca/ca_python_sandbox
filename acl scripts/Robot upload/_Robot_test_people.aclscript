COMMENT
//ANALYTIC Robot script to import people test results
  IMPORT AUDIT TEST RESULTS FROM VARIOUS ODBC CONNECTORS
//RESULT LOG
END

COMMENT
INDEX
ODBC64
    Sqlite_people_test_masterfile->W:\People\People_test_masterfile.sqlite
    Sqlite_people_conflict->W:\People_conflict\People_conflict.sqlite
ENVIRONMENT
PEOPLE
    PEOPLE MASTER FILE TESTS
        PEOPLE_TEST_ASSIGNMENT_CATEGORY_INVALID
        PEOPLE_TEST_EMPLOYEE_CATEGORY_INVALID
        PEOPLE_TEST_EMPLOYEE_GRADE_INVALID
        PEOPLE_TEST_EMPLOYEE_LEAVE_INVALID
        PEOPLE_TEST_ADDRESS_POST_PRIMARY_INVALID
        PEOPLE_TEST_BANKACC_DUPLICATE
        PEOPLE_TEST_BANKACC_SARS_VERIFY
        PEOPLE_TEST_ID_BLANK
        PEOPLE_TEST_ID_DATEOFBIRTH
        PEOPLE_TEST_ID_DUPLICATE
        PEOPLE_TEST_ID_GENDER
        PEOPLE_TEST_ID_INVALID
        PEOPLE_TEST_NAME_DUPLICATE
        PEOPLE_TEST_PASSPORT_BLANK
        PEOPLE_TEST_PASSPORT_DUPLICATE
        PEOPLE_TEST_PAYE_BLANK
        PEOPLE_TEST_PAYE_DUPLICATE
        PEOPLE_TEST_PAYE_INVALID
        PEOPLE_TEST_PHONE_WORK_INVALID
        PEOPLE_TEST_SPOUSE_GROUP_INSURANCE_SPOUSE_OLDER_THAN_65
        PEOPLE_TEST_SPOUSE_GROUP_INSURANCE_NO_ACTIVE_SPOUSE_ON_RECORD
        PEOPLE_TEST_SPOUSE_GROUP_INSURANCE_COMPULSORY
        PEOPLE_TEST_SPOUSE_GROUP_INSURANCE_NOTMARRIED_ACTIVE_INSURANCE
        PEOPLE_TEST_WORK_PERMIT_EXPIRE
    PEOPLE CONFLICT TESTS
        PEOPLE_TEST_BANKACC_VENDOR
        VENDOR_TEST_EMAIL (Inactive 2021-02-22)(Reinstate 2023-01-30)
        CONFLICT_TEST_ACTIVE_DIRECTOR_LIST (Published 2023-12-06)
        CONFLICT_TEST_NO_DECLARE (Reinstate 2023-09-14)
        CONFLICT_TEST_DECLARATION_PENDING (Published 2023-11-15)
        CONFLICT_TEST_ACTIVE_DIRECTOR_ACTIVE_VENDOR_NO_DECLARATION (Published 2023-11-24)
ENVIRONMENT RESET
END

COMMENT ENVIRONMENT
COMMENT ****************************************************************************************************

DO _Password
SET SAFETY OFF

COMMENT PEOPLE MASTER FILE TESTS
COMMENT ****************************************************************************************************

COMMENT PEOPLE_TEST_ASSIGNMENT_CATEGORY_INVALID

ACCESSDATA64 ODBC "Dsn" NAME "Sqlite_people_test_masterfile" TO "PEOPLE_TEST_ASSIGNMENT_CATEGORY_INVALID.FIL" CHARMAX 100 MEMOMAX 100 
SOURCE( )
 SQL_QUERY( SELECT * FROM X007ax_assignment_category_invalid ) END_QUERY
OPEN PEOPLE_TEST_ASSIGNMENT_CATEGORY_INVALID
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL PASSWORD 1 ACLGRC TO "146955@eu"

COMMENT PEOPLE_TEST_EMPLOYEE_CATEGORY_INVALID

ACCESSDATA64 ODBC "Dsn" NAME "Sqlite_people_test_masterfile" TO "PEOPLE_TEST_EMPLOYEE_CATEGORY_INVALID.FIL" CHARMAX 100 MEMOMAX 100 
SOURCE( )
 SQL_QUERY( SELECT * FROM X007bx_employee_category_invalid ) END_QUERY
OPEN PEOPLE_TEST_EMPLOYEE_CATEGORY_INVALID
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL PASSWORD 1 ACLGRC TO "146956@eu"

COMMENT ADDRESS POST PRIMARY INVALID

ACCESSDATA64 ODBC "Dsn" NAME "Sqlite_people_test_masterfile" TO "PEOPLE_TEST_ADDRESS_POST_PRIMARY_INVALID.FIL" CHARMAX 50 MEMOMAX 100 
 SOURCE( )
 SQL_QUERY( SELECT * FROM X008bx_address_primary_invalid ) END_QUERY
OPEN PEOPLE_TEST_ADDRESS_POST_PRIMARY_INVALID
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL PASSWORD 1 ACLGRC TO "80140@eu"

COMMENT BANKACC DUPLICATE

ACCESSDATA64 ODBC "Dsn" NAME "Sqlite_people_test_masterfile" TO "PEOPLE_TEST_BANKACC_DUPLICATE.FIL" CHARMAX 50 MEMOMAX 100 
 SOURCE( )
 SQL_QUERY( SELECT * FROM X004ax_bank_duplicate ) END_QUERY
OPEN People_test_bankacc_duplicate
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL PASSWORD 1 ACLGRC TO "78533@eu"

COMMENT BANKACC SARS VERIFY

ACCESSDATA64 ODBC "Dsn" NAME "Sqlite_people_test_masterfile" TO "PEOPLE_TEST_BANKACC_SARS_VERIFY.FIL" CHARMAX 50 MEMOMAX 100 
 SOURCE( )
 SQL_QUERY( SELECT * FROM X004cx_bank_sars_verify ) END_QUERY
OPEN PEOPLE_TEST_BANKACC_SARS_VERIFY
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL PASSWORD 1 ACLGRC TO "80099@eu"

COMMENT PEOPLE_TEST_EMPLOYEE_GRADE_INVALID

ACCESSDATA64 ODBC "Dsn" NAME "Sqlite_people_test_masterfile" TO "PEOPLE_TEST_EMPLOYEE_GRADE_INVALID.FIL" CHARMAX 100 MEMOMAX 100 
SOURCE( )
 SQL_QUERY( SELECT * FROM X007cx_employee_grade_invalid ) END_QUERY
OPEN PEOPLE_TEST_EMPLOYEE_GRADE_INVALID
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL PASSWORD 1 ACLGRC TO "147731@eu"

COMMENT PEOPLE_TEST_EMPLOYEE_LEAVE_INVALID

ACCESSDATA64 ODBC "Dsn" NAME "Sqlite_people_test_masterfile" TO "PEOPLE_TEST_EMPLOYEE_LEAVE_INVALID.FIL" CHARMAX 100 MEMOMAX 100 
SOURCE( )
 SQL_QUERY( SELECT * FROM X007dx_employee_leave_code_invalid ) END_QUERY
OPEN PEOPLE_TEST_EMPLOYEE_LEAVE_INVALID
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL PASSWORD 1 ACLGRC TO "148213@eu"

COMMENT DATA PEOPLE_TEST_ID_BLANK

ACCESSDATA64 ODBC "Dsn" NAME "Sqlite_people_test_masterfile" TO "PEOPLE_TEST_ID_BLANK.FIL" CHARMAX 50 MEMOMAX 100 
 SOURCE( )
 SQL_QUERY( 
    SELECT
        "X002ax_id_blank".*
    FROM
        "X002ax_id_blank"
 ) END_QUERY
OPEN PEOPLE_TEST_ID_BLANK
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL PASSWORD 1 ACLGRC TO "78511@eu"

COMMENT DATA PEOPLE_TEST_ID_DATEOFBIRTH

ACCESSDATA64 ODBC "Dsn" NAME "Sqlite_people_test_masterfile" TO "PEOPLE_TEST_ID_DATEOFBIRTH.FIL" CHARMAX 50 MEMOMAX 100 
 SOURCE( )
 SQL_QUERY( 
    SELECT
        "X002cx_iddob_invalid".*
    FROM
        "X002cx_iddob_invalid"
 ) END_QUERY
OPEN People_test_id_dateofbirth
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL PASSWORD 1 ACLGRC TO "78689@eu"

COMMENT DATA PEOPLE_TEST_ID_DUPLICATE

ACCESSDATA64 ODBC "Dsn" NAME "Sqlite_people_test_masterfile" TO "PEOPLE_TEST_ID_DUPLICATE.FIL" CHARMAX 50 MEMOMAX 100 
 SOURCE( )
 SQL_QUERY( 
    SELECT
        "X002ex_id_duplicate".*
    FROM
        "X002ex_id_duplicate"
 ) END_QUERY
OPEN People_test_id_duplicate
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL PASSWORD 1 ACLGRC TO "78687@eu"

COMMENT DATA PEOPLE_TEST_ID_GENDER

ACCESSDATA64 ODBC "Dsn" NAME "Sqlite_people_test_masterfile" TO "PEOPLE_TEST_ID_GENDER.FIL" CHARMAX 50 MEMOMAX 100 
 SOURCE( )
 SQL_QUERY( 
    SELECT
        "X002dx_sex_invalid".*
    FROM
        "X002dx_sex_invalid"
 ) END_QUERY
OPEN People_test_id_gender
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL PASSWORD 1 ACLGRC TO "78688@eu"

COMMENT DATA PEOPLE_TEST_ID_INVALID

ACCESSDATA64 ODBC "Dsn" NAME "Sqlite_people_test_masterfile" TO "PEOPLE_TEST_ID_INVALID.FIL" CHARMAX 50 MEMOMAX 100 
 SOURCE( )
 SQL_QUERY( 
    SELECT
        "X002bx_id_invalid".*
    FROM
        "X002bx_id_invalid"
 ) END_QUERY
OPEN People_test_id_invalid
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL PASSWORD 1 ACLGRC TO "78685@eu"

COMMENT DATA PEOPLE_TEST_NAME_DUPLICATE

ACCESSDATA64 ODBC "Dsn" NAME "Sqlite_people_test_masterfile" TO "PEOPLE_TEST_NAME_DUPLICATE.FIL" CHARMAX 50 MEMOMAX 100 
 SOURCE( )
 SQL_QUERY( 
    SELECT
        "X006ax_name_duplicate".*
    FROM
        "X006ax_name_duplicate"
 ) END_QUERY
OPEN People_test_name_duplicate
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL PASSWORD 1 ACLGRC TO "78639@eu"

COMMENT DATA PEOPLE_TEST_PASSPORT_BLANK

ACCESSDATA64 ODBC "Dsn" NAME "Sqlite_people_test_masterfile" TO "PEOPLE_TEST_PASSPORT_BLANK.FIL" CHARMAX 50 MEMOMAX 100 
 SOURCE( )
 SQL_QUERY( 
    SELECT
        "X003ax_pass_blank".*
    FROM
        "X003ax_pass_blank"
 ) END_QUERY
OPEN PEOPLE_TEST_PASSPORT_BLANK
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL PASSWORD 1 ACLGRC TO "78513@eu"

COMMENT DATA PEOPLE_TEST_PASSPORT_DUPLICATE

ACCESSDATA64 ODBC "Dsn" NAME "Sqlite_people_test_masterfile" TO "PEOPLE_TEST_PASSPORT_DUPLICATE.FIL" CHARMAX 50 MEMOMAX 100 
 SOURCE( )
 SQL_QUERY( 
    SELECT
        "X003bx_pass_duplicate".*
    FROM
        "X003bx_pass_duplicate"
 ) END_QUERY
OPEN People_test_passport_duplicate
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL PASSWORD 1 ACLGRC TO "78683@eu"

COMMENT DATA PEOPLE_TEST_PAYE_BLANK

ACCESSDATA64 ODBC "Dsn" NAME "Sqlite_people_test_masterfile" TO "PEOPLE_TEST_PAYE_BLANK.FIL" CHARMAX 50 MEMOMAX 100 
 SOURCE( )
 SQL_QUERY( 
    SELECT
        "X005ax_paye_blank".*
    FROM
        "X005ax_paye_blank"
 ) END_QUERY
OPEN PEOPLE_TEST_PAYE_BLANK
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL PASSWORD 1 ACLGRC TO "78524@eu"

COMMENT DATA PEOPLE_TEST_PAYE_DUPLICATE

ACCESSDATA64 ODBC "Dsn" NAME "Sqlite_people_test_masterfile" TO "PEOPLE_TEST_PAYE_DUPLICATE.FIL" CHARMAX 50 MEMOMAX 100 
 SOURCE( )
 SQL_QUERY( 
    SELECT
        "X005cx_paye_duplicate".*
    FROM
        "X005cx_paye_duplicate"
 ) END_QUERY
OPEN PEOPLE_TEST_PAYE_DUPLICATE
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL PASSWORD 1 ACLGRC TO "78684@eu"

COMMENT DATA PEOPLE_TEST_PAYE_INVALID

ACCESSDATA64 ODBC "Dsn" NAME "Sqlite_people_test_masterfile" TO "PEOPLE_TEST_PAYE_INVALID.FIL" CHARMAX 50 MEMOMAX 100 
 SOURCE( )
 SQL_QUERY( 
    SELECT
        "X005bx_paye_invalid".*
    FROM
        "X005bx_paye_invalid"
 ) END_QUERY
OPEN PEOPLE_TEST_PAYE_INVALID
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL PASSWORD 1 ACLGRC TO "78554@eu"

COMMENT DATA PEOPLE_TEST_PHONE_WORK_INVALID

ACCESSDATA64 ODBC "Dsn" NAME "Sqlite_people_test_masterfile" TO "PEOPLE_TEST_PHONE_WORK_INVALID.FIL" CHARMAX 50 MEMOMAX 100 
 SOURCE( )
 SQL_QUERY( 
    SELECT
        "X008ax_phone_work_invalid".*
    FROM
        "X008ax_phone_work_invalid"
 ) END_QUERY
OPEN PEOPLE_TEST_PHONE_WORK_INVALID
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL PASSWORD 1 ACLGRC TO "80139@eu"

COMMENT PEOPLE_TEST_SPOUSE_GROUP_INSURANCE_SPOUSE_OLDER_THAN_65

ACCESSDATA64 ODBC "Dsn" NAME "Sqlite_people_test_masterfile" TO "PEOPLE_TEST_SPOUSE_OLDER_THAN_65.FIL" CHARMAX 100 MEMOMAX 100 
SOURCE( )
 SQL_QUERY( SELECT * FROM X009ax_spouse_insurance_after_65 ) END_QUERY
OPEN PEOPLE_TEST_SPOUSE_OLDER_THAN_65
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL PASSWORD 1 ACLGRC TO "179822@eu"

COMMENT PEOPLE_TEST_SPOUSE_GROUP_INSURANCE_NO_ACTIVE_SPOUSE_ON_RECORD

ACCESSDATA64 ODBC "Dsn" NAME "Sqlite_people_test_masterfile" TO "PEOPLE_TEST_SPOUSE_NOT_ACTIVE_RECORD.FIL" CHARMAX 100 MEMOMAX 100 
SOURCE( )
 SQL_QUERY( SELECT * FROM X009bx_no_active_spouse_on_record ) END_QUERY
OPEN PEOPLE_TEST_SPOUSE_NOT_ACTIVE_RECORD
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL PASSWORD 1 ACLGRC TO "179203@eu"

COMMENT PEOPLE_TEST_SPOUSE_GROUP_INSURANCE_COMPULSORY

ACCESSDATA64 ODBC "Dsn" NAME "Sqlite_people_test_masterfile" TO "PEOPLE_TEST_SPOUSE_INSURANCE_COMPULSORY.FIL" CHARMAX 100 MEMOMAX 100 
SOURCE( )
 SQL_QUERY( SELECT * FROM X009cx_compulsory_spouse_insurance ) END_QUERY
OPEN PEOPLE_TEST_SPOUSE_INSURANCE_COMPULSORY
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL PASSWORD 1 ACLGRC TO "179917@eu"

COMMENT PEOPLE_TEST_SPOUSE_GROUP_INSURANCE_NOTMARRIED_ACTIVE_INSURANCE

ACCESSDATA64 ODBC "Dsn" NAME "Sqlite_people_test_masterfile" TO "PEOPLE_TEST_SPOUSE_NOTMARRIED_ACTIVE_INSURANCE.FIL" CHARMAX 100 MEMOMAX 100 
SOURCE( )
 SQL_QUERY( SELECT * FROM X009dx_not_married_active_spouse_insurance ) END_QUERY
OPEN PEOPLE_TEST_SPOUSE_NOTMARRIED_ACTIVE_INSURANCE
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL PASSWORD 1 ACLGRC TO "176013@eu"

COMMENT PEOPLE_TEST_SPOUSE_GROUP_INSURANCE_NOTMARRIED_ACTIVE_RECORD

ACCESSDATA64 ODBC "Dsn" NAME "Sqlite_people_test_masterfile" TO "PEOPLE_TEST_SPOUSE_NOTMARRIED_ACTIVE_RECORD.FIL" CHARMAX 100 MEMOMAX 100 
SOURCE( )
 SQL_QUERY( SELECT * FROM X009ex_not_married_active_spouse_record ) END_QUERY
OPEN PEOPLE_TEST_SPOUSE_NOTMARRIED_ACTIVE_RECORD
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL PASSWORD 1 ACLGRC TO "179922@eu"

COMMENT PEOPLE_TEST_WORK_PERMIT_EXPIRE

ACCESSDATA64 ODBC "Dsn" NAME "Sqlite_people_test_masterfile" TO "PEOPLE_TEST_WORK_PERMIT_EXPIRE.FIL" CHARMAX 100 MEMOMAX 100 
SOURCE( )
 SQL_QUERY( SELECT * FROM X003ex_work_permit_expired ) END_QUERY
OPEN PEOPLE_TEST_WORK_PERMIT_EXPIRE
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL PASSWORD 1 ACLGRC TO "149267@eu"

COMMENT PEOPLE CONFLICT TESTS
COMMENT ****************************************************************************************************

COMMENT BANKACC VENDOR

ACCESSDATA64 ODBC "Dsn" NAME "Sqlite_people_conflict" TO "PEOPLE_TEST_BANKACC_VENDOR.FIL" CHARMAX 50 MEMOMAX 100 
 SOURCE( )
 SQL_QUERY( SELECT * FROM X100ax_bank_emp_vend ) END_QUERY
OPEN People_test_bankacc_vendor
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL PASSWORD 1 ACLGRC TO "78769@eu"

COMMENT VENDOR_TEST_EMAIL

COMMENT Reinstated 2023-01-30. Send remediation request to employee directly.
COMMENT Test reporting suspended until further notice 2021-02-22
COMMENT on request from Frikkie Venter. Many reported every day but remediation always approve
COMMENT Test still run in Python as normal

ACCESSDATA64 ODBC "Dsn" NAME "Sqlite_people_conflict" TO "VENDOR_TEST_EMAIL_CONFLICT.FIL" CHARMAX 50 MEMOMAX 100 
SOURCE( )
SQL_QUERY( SELECT * FROM X100bx_employee_vendor_share_email ) END_QUERY
OPEN VENDOR_TEST_EMAIL_CONFLICT
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL PASSWORD 1 ACLGRC TO "91363@eu"

COMMENT CONFLICT_TEST_ACTIVE_DIRECTOR_LIST

ACCESSDATA64 ODBC "Dsn" NAME "Sqlite_people_conflict" TO "CONFLICT_TEST_ACTIVE_DIRECTOR_LIST.FIL" CHARMAX 100 MEMOMAX 100 
SOURCE( )
SQL_QUERY( SELECT * FROM X200ax_active_cipc_director_list) END_QUERY
OPEN CONFLICT_TEST_ACTIVE_DIRECTOR_LIST
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL PASSWORD 1 ACLGRC TO "216190@eu"

COMMENT CONFLICT_TEST_NO_DECLARE

ACCESSDATA64 ODBC "Dsn" NAME "Sqlite_people_conflict" TO "CONFLICT_TEST_NO_DECLARE.FIL" CHARMAX 100 MEMOMAX 100 
SOURCE( )
SQL_QUERY( SELECT * FROM X101ax_employee_no_declaration) END_QUERY
OPEN CONFLICT_TEST_NO_DECLARE
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL PASSWORD 1 ACLGRC TO "145041@eu"

COMMENT CONFLICT_TEST_DECLARATION_PENDING

ACCESSDATA64 ODBC "Dsn" NAME "Sqlite_people_conflict" TO "CONFLICT_TEST_DECLARATION_PENDING.FIL" CHARMAX 100 MEMOMAX 100 
SOURCE( )
SQL_QUERY( SELECT * FROM X101bx_employee_declaration_pending) END_QUERY
OPEN CONFLICT_TEST_DECLARATION_PENDING
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL PASSWORD 1 ACLGRC TO "215135@eu"

COMMENT CONFLICT_TEST_ACTIVE_DIRECTOR_ACTIVE_VENDOR_NO_DECLARATION

ACCESSDATA64 ODBC "Dsn" NAME "Sqlite_people_conflict" TO "CONFLICT_TEST_ACTIVE_DIRECTOR_NO_DECLARATION.FIL" CHARMAX 100 MEMOMAX 100 
SOURCE( )
SQL_QUERY( SELECT * FROM X201ax_active_cipc_vendor_no_declaration) END_QUERY
OPEN CONFLICT_TEST_ACTIVE_DIRECTOR_NO_DECLARATION
COUNT
IF COUNT1 > 0 EXPORT FIELDS ALL PASSWORD 1 ACLGRC TO "215608@eu"

COMMENT ENVIRONMENT RESET
COMMENT ****************************************************************************************************

CLOSE PRIMARY
SET SAFETY ON
